<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test Karaoke</title>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&display=swap" rel="stylesheet"> 
    <link href="https://fonts.googleapis.com/css2?family=Cabin:wght@500&display=swap" rel="stylesheet"> 
    <link rel="stylesheet" href="./files/noplp.css">
</head>
    <body>
        <h1>html5-youtube.js</h1>
		<div class="player js-player" data-youtube-videoid="5RaxWDDo8As"></div>
		<div>
			<select class="js-videos" disabled>
				<option value="5RaxWDDo8As" selected>fox capture plan / 疾走する閃光</option>
				<option value="5wLWhSZ1Uvo">Detektivbyrån - The Making Of "Wermland" Part 5.</option>
			</select>
			<button class="js-load" disabled>Load</button>
			<br />
			<!-- <button class="js-play" disabled>Play</button> -->
			<button class="js-pause" disabled>Pause</button>
			<input class="js-currentTime" type="range" min="0" max="1" value="0" disabled />
			<span class="js-currentTimeText">-:--</span>
			/
			<span class="js-durationText">-:--</span>
			<br />
			<label><input class="js-mute" type="checkbox" disabled>Mute</label>
			<input class="js-volume" type="range" min="0" max="1" step="0.01" value="0" disabled />
			<br />
			<input class="js-playbackRate" type="range" min="0" max="4" step="1" value="2" disabled />
			x<span class="js-playbackRateText">0</span>
			<br />
			<label><input class="js-logging" type="checkbox" checked />Log all events in console</label>
		</div>


<button class="js-play">Play</button>
<p class="lyric">
~~~
</p>

<center>
<input name="input" value="" style="opacity:0.75"></input>
</center>

<div class="lyrics lyrics" style="display: none">
[00:00.00]...
[00:17.08]Y a pas de saison pour que vive la musique au fond
[00:21.27]Pas de saison pour que vive le son
[00:24.64]En marchant tu donnes une cadence à tes pas
[00:28.35]Tu sens la musique au bout de tes doigts
[00:31.73]Tu dis que la vie qu'on t'a donnée est faite pour ça
[00:35.95]Tant de choses grâce au son tu connaîtras
[00:39.56]Ton cœur est un saphir de pick-up
[00:43.75]On a trouvé des décibels dans ton check-up
[00:47.35]Et tu chantes, chantes, chantes ce refrain qui te plaît
[00:51.55]Et tu tapes, tapes, tapes, c'est ta façon d'aimer
[00:55.43]Ce rythme qui t'entraîne jusqu'au bout de la nuit
[00:59.32]Réveille en toi le tourbillon d'un vent de folie
[01:03.36]Et tu chantes, chantes, chantes ce refrain qui te plaît
[01:07.32]Et tu tapes, tapes, tapes, c'est ta façon d'aimer
[01:11.34]Ce rythme qui t'entraîne jusqu'au bout de la nuit
[01:15.05]Réveille en toi le tourbillon d'un vent de folie
[01:33.49]Tu danses le monde, musique américaine
[01:36.97]La cadence du funk au plus haut t'emmène
[01:41.02]Le tempo en délire, si ce soir il fait chaud
[01:44.73]C'est qu'on monte nos mains vers le point le plus haut
[01:49.35]Et tu chantes, chantes, chantes ce refrain qui te plaît
[01:52.59]Et tu tapes, tapes, tapes, c'est ta façon d'aimer
[01:56.46]Ce rythme qui t'entraîne jusqu'au bout de la nuit
[02:00.41]Réveille en toi le tourbillon d'un vent de folie
[02:04.57]Et tu chantes, chantes, chantes ce refrain qui te plaît
[02:08.27]Et tu tapes, tapes, tapes, c'est ta façon d'aimer
[02:12.18]Ce rythme qui t'entraîne jusqu'au bout de la nuit
[02:16.12]Réveille en toi le tourbillon d'un vent de folie
[02:36.50]Toi qui dessines au fond de ton ennui les notes d'une mélodie
[02:39.89]Une musique sans accords majeurs
[02:42.23]C'est une piste sans danseurs
[02:44.19]Mais si tu ranges dans ces moments-là
[02:46.07]Dans un placard tes idées noires
[02:47.85]Les notes pourront se danser
[02:49.81]Et nous reviendrons les chanter
[02:51.87]Quand le sucre est tombé, choqué, le café renversé
[02:53.81]Je sentais bien que la journée était mal commencée
[02:55.97]Plus tard la caisse était cassée avant que craquent les chromes
[02:57.97]Mettant la gomme j'avais détalé
[03:00.06]La musique était mon sourire, les vieux succès mes souvenirs
[03:01.92]On sort tous son dernier soupir
[03:03.04]Lorsqu'on va mourir
[03:04.13]Mais un souffle j'avais gardé car on ne peut pas trépasser
[03:05.93]chacun le sait, sans voir un disc jockey
[03:07.87]Et tu chantes, danses jusqu'au bout de la nuit
[03:09.94]Tes flash en musique funky
[03:12.14]Y a la basse qui frappe et la guitare qui choque
[03:14.35]Il y a le batteur qui s'éclate et toi qui tiens le choc
[03:15.77]Et tu chantes, chantes, chantes ce refrain qui te plaît
[03:19.39]Et tu tapes, tapes, tapes, c'est ta façon d'aimer
[03:22.99]Ce rythme qui t'entraîne jusqu'au bout de la nuit
[03:27.18]Réveille en toi le tourbillon d'un vent de folie
[03:31.13]Et tu chantes, chantes, chantes ce refrain qui te plaît
[03:34.38]Et tu tapes, tapes, tapes, c'est ta façon d'aimer
[03:38.66]Ce rythme qui t'entraîne jusqu'au bout de la nuit
[03:42.45]Réveille en toi le tourbillon d'un vent de folie
[03:46.79]Et tu chantes, chantes, chantes ce refrain qui te plaît
[03:50.69]Et tu tapes, tapes, tapes, c'est ta façon d'aimer
[03:54.02]Ce rythme qui t'entraîne jusqu'au bout de la nuit
[03:58.12]Réveille en toi le tourbillon d'un vent de folie
[04:02.06]Et tu chantes, chantes, chantes ce refrain qui te plaît
[04:05.84]Et tu tapes, tapes, tapes, c'est ta façon d'aimer
</div>

		<script src="html5-youtube/html5-youtube.min.js"></script>
		<script>

const timeAdjust = 1.5;

(function() {
	var elPlayer = document.querySelector('.js-player');
	var elVideos = document.querySelector('.js-videos');
	var elLoad = document.querySelector('.js-load');
	var elPlay = document.querySelector('.js-play');
	var elPause = document.querySelector('.js-pause');
	var elCurrentTime = document.querySelector('.js-currentTime');
	var elCurrentTimeText = document.querySelector('.js-currentTimeText');
	var elDurationText = document.querySelector('.js-durationText');
	var elMute = document.querySelector('.js-mute');
	var elVolume = document.querySelector('.js-volume');
	var elPlaybackRate = document.querySelector('.js-playbackRate');
	var elPlaybackRateText = document.querySelector('.js-playbackRateText');
	var elLogging = document.querySelector('.js-logging');

	elCurrentTimeText.setTime = elDurationText.setTime = function(time) {
		var min = parseInt(time/60, 10);
		var sec = ('0' + parseInt(time%60, 10)).slice(-2);
		var text = min + ':' + sec;
		this.innerHTML = text;
	};

	var player = window.player = youtube({ el:elPlayer });

	player.addEventListener('canplay', function(event) {
		elVideos.disabled = false;
		elLoad.disabled = false;
		elPlay.disabled = false;
		elPause.disabled = true;
		elCurrentTime.disabled = false;
		elMute.disabled = false;
		elVolume.disabled = false;
		elPlaybackRate.disabled = false;

		elCurrentTime.value = player.currentTime;
		elCurrentTimeText.setTime(player.currentTime);
		elVolume.checked = player.muted;
		elVolume.value = player.volume;
		elPlaybackRate.value = youtube.availablePlaybackRates.indexOf(player.playbackRate);
		elPlaybackRateText.innerHTML = player.playbackRate;
	});
	player.addEventListener('play', function(event) {
		// elPlay.disabled = true;
		elPause.disabled = false;
	});
	player.addEventListener('timeupdate', function(event) {
		elCurrentTime.value = player.currentTime;
		elCurrentTimeText.setTime(player.currentTime);
	});
	player.addEventListener('pause', function(event) {
		elPlay.disabled = false;
		elPause.disabled = true;
	});
	player.addEventListener('emptied', function(event) {
		elPlay.disabled = false;
		elPause.disabled = true;
	});
	player.addEventListener('durationchange', function(event) {
		elCurrentTime.max = player.duration;
		elDurationText.setTime(player.duration);
	});
	player.addEventListener('volumechange', function(event) {
		elMute.checked = player.muted;
		elVolume.value = player.volume;
	});
	player.addEventListener('ratechange', function(event) {
		elPlaybackRate.value = youtube.availablePlaybackRates.indexOf(player.playbackRate);
		elPlaybackRateText.innerHTML = player.playbackRate;
	});
	player.addEventListener('error', function(event) {
		console.error(event);
	});

	var typeListener = function(event) { elLogging.checked && console.log(':'+event.type); };
	player.addEventListener('onApiChange', typeListener);
	player.addEventListener('onError', typeListener);
	player.addEventListener('onPlaybackQualityChange', typeListener);
	player.addEventListener('onPlaybackRateChange', typeListener);
	player.addEventListener('onReady', typeListener);
	player.addEventListener('onStateChange', typeListener);
	player.addEventListener('error', typeListener);
	player.addEventListener('emptied', typeListener);
	player.addEventListener('canplay', typeListener);
	player.addEventListener('canplaythrough', typeListener);
	player.addEventListener('playing', typeListener);
	player.addEventListener('ended', typeListener);
	player.addEventListener('durationchange', typeListener);
	player.addEventListener('timeupdate', typeListener);
	player.addEventListener('play', typeListener);
	player.addEventListener('pause', typeListener);
	player.addEventListener('ratechange', typeListener);
	player.addEventListener('volumechange', typeListener);

	elLoad.addEventListener('click', function(event) {
		var videoId = elVideos.value;
		player.src = videoId;
	});
	elPlay.addEventListener('click', function(event) {
		player.play();
        player.currentTime = timeAdjust;
	});
	elPause.addEventListener('click', function(event) {
		player.pause();
	});
	elCurrentTime.addEventListener('change', function(event) {
		player.currentTime = this.value;
	});
	elMute.addEventListener('click', function(event) {
		player.muted = elMute.checked;
	});
	elVolume.addEventListener('change', function(event) {
		player.volume = this.value;
	});
	elPlaybackRate.addEventListener('change', function(event) {
		player.playbackRate = youtube.availablePlaybackRates[this.value];
	});
})();
		</script>


<script>

    const lyric = document.querySelector('.lyric')
    const lyrics = document.querySelector('.lyrics')
    const lines = lyrics.textContent.trim().split('\n')
    
    lyrics.removeAttribute('style')
    lyrics.innerText = ''
    
    let syncData = []
    
    lines.map((line, index) => {
        let [timeStr, text] = line.trim().split(']');
        timeStr = timeStr.replaceAll('[', '');
        let [minStr, secStr] = timeStr.split(':');
        let time = parseInt(minStr)*60 + parseFloat(secStr)
        console.log(time)
        syncData.push({'start': time, 'text': text.trim()})
    })
    
    passed1 = false;
    
    player.addEventListener('timeupdate', function(event) {
        syncData.forEach((item) => {
            console.log(item)
            if (player.currentTime-timeAdjust >= item.start){
                if (player.currentTime-timeAdjust >= 194.29){
                    document.querySelector('.lyric').style.opacity = 0.75 ;
                    document.querySelector('[name=input]').style.opacity = 1 ;
                    player.pause()
                }else{
                    lyric.innerText = item.text
                }
            }
        })
    })
    </script>

    </body>
</html>